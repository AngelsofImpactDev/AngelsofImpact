tinymce.PluginManager.add("ue_image_editor",function(b,a){currentNode="";b.addButton("ue_image_editor",{tooltip:"Image Editor",icon:true,image:tinymce.baseURL+"/plugins/ue_image_editor/img/imageedit_off.gif",onclick:function(){if(currentNode=="IMG"){generalImageFolder="../upload/generalImage/";completeTag=tinymce.activeEditor.selection.getContent();regexImgSearch=/<img.*?src="(.*?)"/;currentSrc=regexImgSearch.exec(completeTag)[1];currentSrcArr=currentSrc.split("/");currentSrcLen=parseInt(currentSrcArr.length)-1;currentSrc=currentSrcArr[currentSrcLen];if(currentSrcArr[0]==".."){var c=new Image();c.src=generalImageFolder+currentSrc;curWidth=c.naturalWidth;curHeight=c.naturalHeight;$("#editTabCropBtn").click();currentImageEditId="";currentImageEditTable="";currentImageEditColumn="";currentImageEditSrc=currentSrc;currentImageEditFolder=generalImageFolder;currentImageEditRealWidth=curWidth;currentImageEditRealHeight=curHeight;$("#imageAreaCorrespondingFolder").val(currentImageEditFolder);$("#imageAreaCorrespondingSrc").val(currentImageEditSrc);$("#imageEditArea").attr("src",currentImageEditFolder+currentImageEditSrc);$("#imageAreaSrc").html(currentImageEditSrc);if(currentImageEditRealWidth>430){$("#imageEditArea").attr("width","100%")}else{$("#imageEditArea").removeAttr("width")}setTimeout(function(){imageAreaEditActive=$("#imageEditArea").imgAreaSelect({instance:true,imageWidth:currentImageEditRealWidth,imageHeight:currentImageEditRealHeight,onSelectEnd:function(d,e){imageAreaWidthResult=parseInt(e.x2)-parseInt(e.x1);imageAreaHeightResult=parseInt(e.y2)-parseInt(e.y1);if(imageAreaWidthResult>0&&imageAreaHeightResult>0){$("#imageAreaEditX").val(e.x1);$("#imageAreaEditY").val(e.y1);$("#imageAreaEditW").val(imageAreaWidthResult);$("#imageAreaEditH").val(imageAreaHeightResult)}else{$("#imageAreaEditX").val(0);$("#imageAreaEditY").val(0);$("#imageAreaEditW").val(0);$("#imageAreaEditH").val(0)}}})},300);$.magnificPopup.open({items:{src:"#imageEditBox"},type:"inline",callbacks:{close:function(){if(imageAreaEditActive){deselectImageEditarea()}}}})}else{alert("You can only edit self hosted images")}}else{alert("Please select an image")}}});b.on("click",function(c){currentNode=tinymce.activeEditor.selection.getNode().nodeName;if(currentNode!="IMG"){currentNode==""}})});